{# templates/component/navbar.html.twig #}

<!-- Styles int√©gr√©s pour la navbar -->
<style>
    /* Bandeau promo */
    .promo-banner {
        background-color: #000;
        color: #ff0000;
        padding: 15px 0;
        overflow: hidden;
        width: 100%;
    }

    .promo-banner-content {
        display: inline-block;
        white-space: nowrap;
        animation: scroll-left 20s linear infinite;
        font-size: 16px;
        font-weight: bold;
    }

    .promo-banner-content span {
        margin: 0 50px;
    }

    @keyframes scroll-left {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }

    /* Logo */
    .logo-section {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px 0;
        background-color: #fff;
    }

    .logo-section img {
        height: 200px;
        width: auto;
    }

    /* Navbar */
    .navbar {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 15px 40px;
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        position: relative;
        width: 100%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .nav-links {
        display: flex;
        gap: 50px;
        list-style: none;
        font-family: 'Bungee Spice', cursive;
    }

    .nav-links li a {
        text-decoration: none;
        color: #9c6a40;
        font-size: 16px;
        transition: color 0.3s ease;
    }

    .nav-links li a:hover {
        color: #D05060;
    }

    /* Boutons √† droite */
    .nav-buttons {
        display: flex;
        gap: 15px;
        align-items: center;
        position: absolute;
        right: 40px;
    }

    /* Boutons (panier et login) */
    .btn,
    .btn-panier,
    .btn-login {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        border: none;
        background-color: #c5a387;
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        transition: all 0.3s ease;
        position: relative;
        text-decoration: none;
    }

    .btn:hover,
    .btn-panier:hover,
    .btn-login:hover {
        background-color: #D05060;
        transform: translateY(-2px);
    }

    .cart-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff0000;
    color: white;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    display: flex;  /* ‚Üê Toujours en flex */
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    opacity: 0;  /* ‚Üê Cach√© avec opacity */
    transform: scale(0);  /* ‚Üê Animation au d√©part */
    transition: all 0.3s ease;
}

.cart-badge.show {
    opacity: 1;
    transform: scale(1);
}

    /* Bouton utilisateur */
    .btn-user {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        border: none;
        background-color: #c5a387;
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        transition: all 0.3s ease;
    }

    .btn-user:hover {
        background-color: #D05060;
    }

    .btn-user .fa-chevron-down {
        font-size: 12px;
        transition: transform 0.3s ease;
    }

    /* Menu utilisateur */
    .user-menu {
        position: relative;
    }

    /* IMPORTANT : Menu cach√© par d√©faut */
    .dropdown-menu {
        position: absolute;
        top: calc(100% + 10px);
        right: 0;
        background: white;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        min-width: 260px;
        overflow: hidden;
        z-index: 1000;
        
        /* Cach√© par d√©faut */
        display: none;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
    }

    /* Menu visible quand actif */
    .user-menu.active .dropdown-menu {
        display: block;
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* Fl√®che du dropdown */
    .dropdown-menu::before {
        content: '';
        position: absolute;
        top: -8px;
        right: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-bottom: 8px solid white;
    }

    /* Header du dropdown */
    .dropdown-header {
        padding: 15px 20px;
        background: linear-gradient(135deg, #c5a387 0%, #9c6a40 100%);
        color: white;
    }

    .user-name {
        font-weight: 600;
        font-size: 16px;
        margin-bottom: 3px;
    }

    .user-email {
        font-size: 12px;
        opacity: 0.9;
    }

    /* Items du menu */
    .dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: #333;
        text-decoration: none;
        transition: all 0.2s ease;
        border-bottom: 1px solid #f0f0f0;
        font-size: 14px;
    }

    .dropdown-item:last-child {
        border-bottom: none;
    }

    .dropdown-item i {
        font-size: 16px;
        color: #9c6a40;
        width: 20px;
        text-align: center;
    }

    .dropdown-item:hover {
        background: #f8f8f8;
        padding-left: 25px;
    }

    .dropdown-item.logout {
        color: #D05060;
        font-weight: 600;
    }

    .dropdown-item.logout i {
        color: #D05060;
    }

    .dropdown-item.logout:hover {
        background: #fff5f5;
    }

    /* Rotation de la fl√®che */
    .user-menu.active .btn-user .fa-chevron-down {
        transform: rotate(180deg);
    }
</style>

<!-- Bandeau promo -->
<div class="promo-banner">
    <div class="promo-banner-content">
        <span>üéâ Livraison offerte d√®s 20‚Ç¨</span>
        <span>üç™ Nouveaux cookies chaque semaine</span>
        <span>‚ú® Cookies d'exception faits maison</span>
        <span>üéâ Livraison offerte d√®s 20‚Ç¨</span>
        <span>üç™ Nouveaux cookies chaque semaine</span>
        <span>‚ú® Cookies d'exception faits maison</span>
    </div>
</div>

<!-- Logo -->
<div class="logo-section">
    <a href="{{ path('app_home') }}">
        <img src="asset/perline.jpg" alt="Logo">
    </a>
</div>

<!-- Navbar -->
<nav class="navbar">
    <!-- Liens de navigation centr√©s -->
    <ul class="nav-links">
        <li><a href="{{ path('app_quisommesnous') }}">Qui sommes nous ?</a></li>
        <li><a href="{{ path('app_produits') }}">Nos Cookies</a></li>
        <li><a href="{{ path('app_box') }}">Nos Box</a></li>
        <li><a href="{{ path('app_contact') }}"> Contactez-nous </a></li>
    </ul>

    <!-- Boutons √† droite -->
    <div class="nav-buttons">
        <!-- Bouton Panier -->
        <button onclick="openModalPanier()" class="btn btn-panier" type="button">
            <i class="fa-solid fa-basket-shopping"></i>
            Panier
            <span class="cart-badge" id="cartBadge">0</span>
        </button>

        <!-- SI CONNECT√â : Menu utilisateur avec dropdown -->
        {% if app.user %}
            <div class="user-menu">
                <button class="btn btn-user" onclick="toggleUserMenu()">
                    <i class="fas fa-user-circle"></i>
                    {{ app.user.prenom ?? 'Mon compte' }}
                    <i class="fas fa-chevron-down"></i>
                </button>

               <div class="dropdown-menu">
    <div class="dropdown-header">
        <div class="user-name">{{ app.user.prenom }} {{ app.user.nom }}</div>
        <div class="user-email">{{ app.user.email }}</div>
    </div>
    
    <a href="{{ path('app_user_dashboard') }}" class="dropdown-item">
        <i class="fas fa-user-cog"></i>
        Mon profil
    </a>
    
    <a href="{{ path('app_user_dashboard') }}#adresses" class="dropdown-item">
        <i class="fas fa-map-marker-alt"></i>
        Mes adresses
    </a>
    
    <a href="{{ path('app_user_dashboard') }}#paiement" class="dropdown-item">
        <i class="fas fa-credit-card"></i>
        Moyens de paiement
    </a>
    
    <a href="{{ path('app_user_dashboard') }}#commandes" class="dropdown-item">
        <i class="fas fa-box"></i>
        Mes commandes
    </a>
    
    <a href="{{ path('app_logout') }}" class="dropdown-item logout">
        <i class="fas fa-sign-out-alt"></i>
        D√©connexion
    </a>
</div>
            </div>
        {% else %}
            <!-- SI NON CONNECT√â : Bouton Login simple -->
            <a href="{{ path('app_login') }}" class="btn btn-login">
                <i class="fas fa-sign-in-alt"></i>
                Login
            </a>
        {% endif %}
    </div>
</nav>

<!-- JavaScript int√©gr√© -->
<script>
    console.log('‚úÖ Navbar JavaScript charg√©');

    // Toggle menu utilisateur
    function toggleUserMenu() {
        const userMenu = document.querySelector('.user-menu');
        if (userMenu) {
            userMenu.classList.toggle('active');
            console.log('Menu toggled:', userMenu.classList.contains('active'));
        }
    }

    // Fermer le menu en cliquant ailleurs
    document.addEventListener('click', function(event) {
        const userMenu = document.querySelector('.user-menu');
        
        if (!userMenu) return;
        
        if (!userMenu.contains(event.target)) {
            userMenu.classList.remove('active');
            console.log('Menu ferm√© (clic ext√©rieur)');
        }
    });

    // Ouvre la modal du panier
    function openModalPanier() {
        const modal = document.getElementById('modalPanier');
        if (modal) {
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            chargerPanier();
        } else {
            console.warn('‚ö†Ô∏è Modal panier introuvable');
        }
    }

    // Ferme la modal du panier
    function closeModalPanier() {
        const modal = document.getElementById('modalPanier');
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    }

    // Charge le contenu du panier via l'API
    async function chargerPanier() {
        try {
            const response = await fetch('/panier/api/panier');
            
            if (!response.ok) {
                throw new Error(`Erreur HTTP: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.success) {
                updateCartBadge(data.nombre_articles);
            }
        } catch (error) {
            console.error('‚ùå Erreur lors du chargement du panier:', error);
            updateCartBadge(0);
        }
    }

    // Met √† jour le badge du panier
    function updateCartBadge(count) {
        const badge = document.getElementById('cartBadge');
        if (!badge) return;
        
        badge.textContent = count;
        
        if (count === 0) {
    badge.classList.remove('show');
} else {
    badge.classList.add('show');
}
    }

    // Animation du badge
    function animateCartBadge() {
        const badge = document.getElementById('cartBadge');
        if (!badge) return;
        
        badge.style.animation = 'none';
        setTimeout(() => {
            badge.style.animation = 'bounce 0.5s ease';
        }, 10);
    }

    // Initialisation au chargement
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ DOM charg√©');
        
        // Charger le nombre d'articles dans le panier
        chargerPanier();
        
        // Fermer la modal panier en cliquant en dehors
        const modalPanier = document.getElementById('modalPanier');
        if (modalPanier) {
            modalPanier.addEventListener('click', function(event) {
                if (event.target === modalPanier) {
                    closeModalPanier();
                }
            });
        }
        
        console.log('Menu user:', document.querySelector('.user-menu'));
        console.log('Dropdown:', document.querySelector('.dropdown-menu'));
    });

    // Animation bounce pour le badge
    // Animation bounce pour le badge
const navbarStyle = document.createElement('style');  // ‚úÖ Nom diff√©rent
navbarStyle.textContent = `
    @keyframes bounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.3); }
    }
`;
document.head.appendChild(navbarStyle);
</script>