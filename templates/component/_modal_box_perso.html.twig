{# Modal Box Personnalisable #}
<div id="modalBoxPerso" style="display: none;">
    <div>
        <div>
            <h2>
                <i class="fas fa-magic"></i> 
                Compose ta box personnalisée
            </h2>
            <button type="button" onclick="closeModalBoxPerso()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div>
            {# Compteur de cookies sélectionnés #}
            <div>
                <div>
                    <i class="fas fa-cookie-bite"></i>
                    <span id="cookiesSelected">{# Nombre de cookies sélectionnés (mis à jour par JS) #}0</span> / 12 cookies sélectionnés
                </div>
                <div>
                    <div id="progressBar" style="width: 0%"></div>
                </div>
            </div>

            {# Liste des cookies disponibles #}
            <div>
                {% for produit in produits %}{# Boucle sur tous les produits disponibles #}
                    {% if produit.stock > 0 %}{# Afficher uniquement les produits en stock #}
                        <div data-produit-id="{{ produit.id }}">
                            <div>
                                <img src="{{ asset('uploads/produits/' ~ produit.image) }}" 
                                     alt="{{ produit.name }}">
                                
                                {% if produit.stock < 5 %}{# Badge si stock faible #}
                                    <span>Stock limité</span>
                                {% endif %}
                            </div>

                            <div>
                                <h4>{# Nom du produit #}{{ produit.name }}</h4>
                                <p>{# Prix du produit formaté #}{{ produit.prix|number_format(2, ',', ' ') }} €</p>
                                <p>Stock: {# Quantité en stock #}{{ produit.stock }}</p>
                            </div>

                            {# Sélecteur de quantité #}
                            <div>
                                <button type="button" 
                                        onclick="updateCookieQty({{ produit.id }}, -1, {{ produit.stock }})"
                                        disabled>
                                    <i class="fas fa-minus"></i>
                                </button>
                                
                                <input type="number" 
                                       id="qty_{{ produit.id }}"
                                       value="0" 
                                       min="0" 
                                       max="{{ produit.stock }}"
                                       readonly>
                                
                                <button type="button" 
                                        onclick="updateCookieQty({{ produit.id }}, 1, {{ produit.stock }})">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div>
            <div>
                <p>Prix total: <strong>{# Prix de la box personnalisable #}{{ box_personnalisable.prix|number_format(2, ',', ' ') }} €</strong></p>
                <p>
                    <i class="fas fa-info-circle"></i> 
                    Sélectionnez exactement 12 cookies
                </p>
            </div>
            
            <div>
                <button type="button" onclick="closeModalBoxPerso()">
                    Annuler
                </button>
                <button type="button" 
                        id="btnValiderBox" 
                        onclick="validerBoxPerso()"
                        disabled>
                    <i class="fas fa-shopping-cart"></i> 
                    Ajouter au panier
                </button>
            </div>
        </div>
    </div>
</div>