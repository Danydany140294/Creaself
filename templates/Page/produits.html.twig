{% extends 'base.html.twig' %}

{% block title %}{# Titre de la page #}Nos Cookies - CreaSelf{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/produits.css') }}">
{% endblock %}

{% block body %}

{# ========== EN-T√äTE PAGE ========== #}
<section>
    <div>
        <h1>{# Titre principal #}Nos Cookies Artisanaux</h1>
        <p>{# Sous-titre #}D√©couvrez notre s√©lection de cookies faits maison avec amour</p>
    </div>
</section>

{# ========== BANNI√àRE BOX PERSONNALISABLE ========== #}
{% if box_personnalisable %}{# Affichage conditionnel si box perso existe #}
    <section>
        <div>
            <div>
                <i class="fas fa-magic"></i>
            </div>
            <div>
                <h2>üç™ Compose ta box personnalis√©e !</h2>
                <p>Choisis 12 cookies parmi nos {# Nombre total de produits #}{{ produits|length }} saveurs pour seulement {# Prix de la box perso format√© #}{{ box_personnalisable.prix|number_format(2, ',', ' ') }} ‚Ç¨</p>
            </div>
            <button type="button" onclick="openModalBoxPerso()">
                <i class="fas fa-cookie-bite"></i> Composer ma box
            </button>
        </div>
    </section>
{% endif %}

{# ========== LISTE DES COOKIES ========== #}
<section>
    <div>
        
        {% if produits|length > 0 %}{# Si des produits existent #}
            <div>
                {% for produit in produits %}{# Boucle sur tous les produits #}
                    <div>
                        {# Image du cookie #}
                        <div>
                            <img src="{{ asset('uploads/produits/' ~ produit.image) }}" 
                                 alt="{{ produit.name }}">
                            
                            {# Badges de stock #}
                            {% if produit.stock == 0 %}{# Si rupture de stock #}
                                <span>Rupture</span>
                            {% elseif produit.stock < 5 %}{# Si stock faible (moins de 5) #}
                                <span>Stock limit√©</span>
                            {% endif %}
                        </div>

                        {# Informations cookie #}
                        <div>
                            <h3>{# Nom du produit #}{{ produit.name }}</h3>
                            
                            {# Prix #}
                            <div>
                                <span>{# Prix format√© en euros #}{{ produit.prix|number_format(2, ',', ' ') }} ‚Ç¨</span>
                                <span>/ pi√®ce</span>
                            </div>

                            {# Stock #}
                            <div>
                                {% if produit.stock > 0 %}{# Si en stock #}
                                    <i class="fas fa-check-circle"></i>
                                    <span>{# Quantit√© en stock #}{{ produit.stock }} en stock</span>
                                {% else %}{# Si rupture #}
                                    <i class="fas fa-times-circle"></i>
                                    <span>Rupture de stock</span>
                                {% endif %}
                            </div>

                            {# Formulaire ajout panier #}
                            {% if produit.stock > 0 %}{# Formulaire affich√© uniquement si stock disponible #}
                                <form method="POST" 
                                      action="{{ path('app_panier_ajouter_produit', {id: produit.id}) }}">
                                    
                                    <div>
                                        <label for="quantite_{{ produit.id }}">Quantit√©:</label>
                                        <div>
                                            <button type="button" 
                                                    onclick="updateQty('quantite_{{ produit.id }}', -1, 1, {{ produit.stock }})"
                                                    aria-label="Diminuer la quantit√©">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            
                                            <input type="number" 
                                                   id="quantite_{{ produit.id }}"
                                                   name="quantite" 
                                                   value="1" 
                                                   min="1" 
                                                   max="{{ produit.stock }}"
                                                   readonly>
                                            
                                            <button type="button" 
                                                    onclick="updateQty('quantite_{{ produit.id }}', 1, 1, {{ produit.stock }})"
                                                    aria-label="Augmenter la quantit√©">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <button type="submit">
                                        <i class="fas fa-shopping-cart"></i> Ajouter au panier
                                    </button>
                                </form>
                            {% else %}{# Bouton d√©sactiv√© si rupture #}
                                <button disabled>
                                    <i class="fas fa-ban"></i> Indisponible
                                </button>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}{# Si aucun produit disponible #}
            <div>
                <i class="fas fa-cookie-bite fa-3x"></i>
                <p>Aucun cookie disponible pour le moment.</p>
                <a href="{{ path('app_home') }}">
                    <i class="fas fa-arrow-left"></i> Retour √† l'accueil
                </a>
            </div>
        {% endif %}

    </div>
</section>

{# ========== SECTION CTA BOX PERSO (bas de page) ========== #}
{% if box_personnalisable %}{# Call-to-action pour la box personnalisable #}
    <section>
        <div>
            <div>
                <i class="fas fa-gift"></i>
            </div>
            <div>
                <h3>Envie d'un assortiment sur mesure ?</h3>
                <p>Cr√©ez votre box personnalis√©e avec 12 cookies de votre choix !</p>
            </div>
            <button type="button" onclick="openModalBoxPerso()">
                <i class="fas fa-magic"></i> Cr√©er ma box
            </button>
        </div>
    </section>
{% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script>
        /**
         * Gestion des quantit√©s +/-
         */
        function updateQty(inputId, delta, min, max) {
            const input = document.getElementById(inputId);
            let currentValue = parseInt(input.value) || min;
            let newValue = currentValue + delta;
            
            // Limiter entre min et max
            if (newValue >= min && newValue <= max) {
                input.value = newValue;
            }
        }

        /**
         * Animation au scroll
         */
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.cookie-card');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            }, {
                threshold: 0.1
            });

            cards.forEach(card => {
                observer.observe(card);
            });
        });
    </script>
{% endblock %}

