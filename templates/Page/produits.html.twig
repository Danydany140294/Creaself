{% extends 'base.html.twig' %}

{% block title %}Nos Cookies - Perline{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# Swiper CSS #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    {# CSS personnalis√© Perline #}
    <link rel="stylesheet" href="{{ asset('css/produits.css') }}">
{% endblock %}

{% block body %}

{# ========== SECTION HERO CENTR√âE AVEC GRAND SWIPER ========== #}
<section class="nc-hero">
    <div class="nc-hero-content">
        <h1>Nos <span>Cookies</span> </h1>
        
    </div>

    {# Swiper - Grand carrousel style 3D #}
    <div class="nc-hero-swiper">
        <div class="swiper nc-swiper">
            <div class="swiper-wrapper">
                {% for produit in produits|slice(0, 5) %}
                    <div class="swiper-slide">
                        <div class="nc-slide-card">
                            <div class="nc-slide-image">
                                <img src="{{ asset('asset/images/produits/' ~ produit.image) }}"  
                                     alt="{{ produit.name }}">
                            </div>
                            <div class="nc-slide-content">
                                <h3>{{ produit.name }}</h3>
                                <p>{{ produit.description ?? 'Cookie artisanal fait maison avec amour' }}</p>
                                
                                {% if produit.stock > 0 %}
                                    <button class="nc-btn nc-btn-primary" 
                                            onclick="scrollToProduct({{ produit.id }})">
                                        Commander
                                    </button>
                                {% else %}
                                    <button class="nc-btn nc-btn-primary" disabled>
                                        Indisponible
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {# Navigation du swiper #}
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-pagination"></div>
        </div>
    </div>
</section>

{# ========== SECTION TAGS PRODUITS (sous le hero) ========== #}
<section class="nc-product-tags">
    <div class="nc-tag-item">
        <span class="nc-tag-label">{{ produits|length }}</span>
        <span class="nc-tag-text">Saveurs</span>
    </div>
    {% if box_personnalisable %}
    <div class="nc-tag-item">
        <span class="nc-tag-label">{{ box_personnalisable.prix|number_format(2, ',', ' ') }}‚Ç¨</span>
        <span class="nc-tag-text">Box 12 cookies</span>
    </div>
    {% endif %}
    <div class="nc-tag-item">
        <span class="nc-tag-label">100%</span>
        <span class="nc-tag-text">Artisanal</span>
    </div>
</section>

{# ========== BANNI√àRE BOX PERSONNALISABLE ========== #}
{% if box_personnalisable %}
    <section class="nc-box-banner">
        <div class="nc-box-content">
            <div class="nc-box-icon">
                <i class="fas fa-magic"></i>
            </div>
            <div class="nc-box-text">
                <h2>üç™ Compose ta box personnalis√©e !</h2>
                <p>Choisis 12 cookies parmi nos {{ produits|length }} saveurs pour seulement {{ box_personnalisable.prix|number_format(2, ',', ' ') }} ‚Ç¨</p>
            </div>
            <button type="button" class="nc-btn nc-btn-primary" onclick="openModalBoxPerso()">
                <i class="fas fa-cookie-bite"></i> Composer ma box
            </button>
        </div>
    </section>
{% endif %}

{# ========== GRILLE DES PRODUITS ========== #}
<section id="cookies" class="nc-products">
    <h2>Nos cookies stars</h2>

    {% if produits|length > 0 %}
        <div class="nc-product-grid">
            {% for produit in produits %}
                <article class="nc-product-card" id="product-{{ produit.id }}">
                    
                    {# Image du produit #}
                    <div class="nc-product-image">
                        <img src="{{ asset('asset/images/produits/' ~ produit.image) }}" 
                             alt="{{ produit.name }}">
                        
                        {# Badges de disponibilit√© #}
                        {% if produit.stock == 0 %}
                            <span class="nc-badge nc-badge-out">Rupture</span>
                        {% elseif produit.stock < 5 %}
                            <span class="nc-badge nc-badge-limited">Stock limit√©</span>
                        {% endif %}
                    </div>

                    {# Informations produit #}
                    <h3>{{ produit.name }}</h3>
                    
                    {# Prix #}
                    <p class="nc-product-price">{{ produit.prix|number_format(2, ',', ' ') }} ‚Ç¨</p>
                    
                    {# Indicateur de stock #}
                    <div class="nc-stock-info">
                        {% if produit.stock > 0 %}
                            <i class="fas fa-check-circle"></i>
                            <span>{{ produit.stock }} en stock</span>
                        {% else %}
                            <i class="fas fa-times-circle"></i>
                            <span>Rupture de stock</span>
                        {% endif %}
                    </div>

                    {# Formulaire d'ajout au panier #}
                    {% if produit.stock > 0 %}
                        <form method="POST" 
                              action="{{ path('app_panier_ajouter_produit', {id: produit.id}) }}"
                              class="nc-add-to-cart-form">
                            
                            {# S√©lecteur de quantit√© #}
                            <div class="nc-quantity-selector">
                                <label for="quantite_{{ produit.id }}">Quantit√©:</label>
                                <div class="nc-quantity-controls">
                                    <button type="button" 
                                            class="nc-qty-btn"
                                            onclick="updateQty('quantite_{{ produit.id }}', -1, 1, {{ produit.stock }})"
                                            aria-label="Diminuer">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    
                                    <input type="number" 
                                           id="quantite_{{ produit.id }}"
                                           name="quantite" 
                                           value="1" 
                                           min="1" 
                                           max="{{ produit.stock }}"
                                           readonly>
                                    
                                    <button type="button" 
                                            class="nc-qty-btn"
                                            onclick="updateQty('quantite_{{ produit.id }}', 1, 1, {{ produit.stock }})"
                                            aria-label="Augmenter">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            {# Bouton d'ajout #}
                            <button type="submit" class="nc-btn nc-btn-secondary">
                                <i class="fas fa-shopping-cart"></i> Ajouter au panier
                            </button>
                        </form>
                    {% else %}
                        <button class="nc-btn nc-btn-secondary" disabled>
                            <i class="fas fa-ban"></i> Indisponible
                        </button>
                    {% endif %}
                </article>
            {% endfor %}
        </div>
    {% else %}
        {# Message si aucun produit disponible #}
        <div class="nc-no-products">
            <i class="fas fa-cookie-bite fa-3x"></i>
            <p>Aucun cookie disponible pour le moment.</p>
            <a href="{{ path('app_home') }}" class="nc-btn nc-btn-outline">
                <i class="fas fa-arrow-left"></i> Retour √† l'accueil
            </a>
        </div>
    {% endif %}
</section>

{# ========== CTA BOX PERSONNALISABLE (bas de page) ========== #}
{% if box_personnalisable %}
    <section class="nc-box-cta">
        <div class="nc-cta-content">
            <div class="nc-cta-icon">
                <i class="fas fa-gift"></i>
            </div>
            <div class="nc-cta-text">
                <h3>Envie d'un assortiment sur mesure ?</h3>
                <p>Cr√©ez votre box personnalis√©e avec 12 cookies de votre choix !</p>
            </div>
            <button type="button" class="nc-btn nc-btn-primary" onclick="openModalBoxPerso()">
                <i class="fas fa-magic"></i> Cr√©er ma box
            </button>
        </div>
    </section>
{% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    {# Swiper JS - OBLIGATOIRE AVANT produits.js #}
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    {# Script principal Perline - Contient TOUT : Swiper init, AJAX, animations #}
    <script src="{{ asset('js/produits.js') }}"></script>
{% endblock %}